(()=>{var e={459:e=>{e.exports={fromDbColumnFormat:function(e){let t=[];return-1!=e.search(/,/g)?e.split(", ").forEach((e=>{t.push({id:e.split(":")[0],value:e.split(":")[1]})})):t.push({id:e.split(":")[0],value:e.split(":")[1]}),t},toDbColumnFormat:function(e){}}}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,n),o.exports}(()=>{"use strict";const e=class{constructor(e){this.params=e}setTitle(e){document.title=e}async getHtml(){return""}routine(){}};var t=n(459);class i{static setAppHtml(e){document.querySelector("#app").innerHTML=e}static renderNoteView(e){let n=new Date(1e3*e.creating_timestamp),r=s(e.links,"link_button"),o=s(e.tags,"tag_button"),a=`\n    <div class="note_view">\n      Note ${e.id}:  ${e.title}<br>\n      ====================<br>\n      <div class="note_body">\n        ${e.body}<br>\n      </div>\n        creation date: ${n}<br>\n        tags: ${o}<br>\n        links: ${r}<br>\n    </div>\n    <div class="button_section">\n      <button id='${e.id}' name='edit-note-btn'>Edit</button>\n      <button id='${e.id}:${e.title}' name='create-linked-note-btn'>Create linked note</button>\n    </div>\n    `;function s(e,n){let i="";return(0,t.fromDbColumnFormat)(e).forEach((e=>{i+=`\n        <button class='${n}' data-button_id="${e.id}">${e.value}</button>\n        `})),i}i.setAppHtml(a),document.querySelectorAll(".note_view")[0].addEventListener("click",(e=>{"link_button"==e.target.className&&u.navigateTo(`/view-note/${e.target.dataset.button_id}`)}))}static renderNoteHeads(e){let t='<div id="note_list">';e.reverse().forEach((e=>{t+="<div><br>",t+=e.title+"<br>",t+=`<button id='${e.id}' name='open-note-btn'>Open</button>`,t+=`<button id='${e.id}' name='delete-note-btn'>Delete</button>`,t+="</div>"})),t+="</div>",i.setAppHtml(t)}}function r(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==this.readyState&&200==this.status&&t(JSON.parse(n.responseText))},n.open("GET",e,!0),n.send()}function o(e,t,n,i){const r=new XMLHttpRequest;r.onreadystatechange=function(){r.readyState==XMLHttpRequest.DONE&&(200==r.status?n(JSON.parse(r.responseText)):i(JSON.parse(r.statusText)))},r.open("POST",t),r.setRequestHeader("Content-Type","application/json"),r.send(JSON.stringify(e))}class a extends e{constructor(e){super(e),this.setTitle("ShowAll")}async getHtml(){return r("/fetch-all-notes",this.showAll),""}routine(){}showAll(e){i.renderNoteHeads(e),document.querySelector("#note_list").addEventListener("click",a.buttonHandler)}static buttonHandler(e){"open-note-btn"===e.srcElement.name?a.openNote(e.srcElement.id):"delete-note-btn"===e.srcElement.name&&a.deleteNote(e.srcElement.id)}static openNote(e){u.navigateTo(`/view-note/${e}`)}static deleteNote(e){console.log("delete "+e),o({id:e},"/delete-note-by-id",(e=>{console.log(e),location.reload()}))}}class s{constructor(e,t,n=(()=>{})){this.currentFocus=-1,this.inp=e,this.arr=t,this.autocomplete_callback=n,this.autocomplete()}autocomplete(){this.inp.addEventListener("input",this.inputListener.bind(this)),this.inp.addEventListener("keydown",this.keyDownListener.bind(this)),document.addEventListener("click",function(e){this.closeAllLists(e.target)}.bind(this))}keyDownListener(e){var t=document.getElementById(this.inp.id+"autocomplete-list");t&&(t=t.getElementsByTagName("div")),40==e.keyCode?(this.currentFocus++,this.addActive(t)):38==e.keyCode?(this.currentFocus--,this.addActive(t)):13==e.keyCode?(e.preventDefault(),this.currentFocus>-1?t&&t[this.currentFocus].click():t&&1==t.length&&t[0].click()):9==e.keyCode&&(e.preventDefault(),-1==this.currentFocus&&1==t.length&&t[0].click())}inputListener(e){let t,n,i=this.inp.value;if(this.closeAllLists(),!i)return!1;this.inp.currentFocus=-1,t=document.createElement("DIV"),t.setAttribute("id",this.inp.id+"autocomplete-list"),t.setAttribute("class","autocomplete-items"),this.inp.parentNode.appendChild(t);for(let e=0;e<this.arr.length;e++)this.arr[e].value.substr(0,i.length).toUpperCase()==i.toUpperCase()&&(this.arr[e].value,n=document.createElement("DIV"),n.innerHTML="<strong>"+this.arr[e].value.substr(0,i.length)+"</strong>",n.innerHTML+=this.arr[e].value.substr(i.length),n.innerHTML+="<input type='hidden' value='"+this.arr[e].value+"'>",n.addEventListener("click",function(e,t){this.inp.value="",this.autocomplete_callback(e),this.closeAllLists(),this.currentFocus=-1}.bind(this,this.arr[e])),t.appendChild(n))}addActive(e){if(!e)return!1;this.removeActive(e),this.currentFocus>=e.length&&(this.currentFocus=0),this.currentFocus<0&&(this.currentFocus=e.length-1),e[this.currentFocus].classList.add("autocomplete-active")}removeActive(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")}closeAllLists(e){for(var t=document.getElementsByClassName("autocomplete-items"),n=0;n<t.length;n++)e!=t[n]&&e!=this.inp&&t[n].parentNode.removeChild(t[n])}}class l{static renderNoteForm(e,n){let a,l,d="",c="",u="";switch(n){case"linked_note":case"create_mode":a="Create note",l="Create";break;case"edit_mode":a="Edit note",l="Save",d=e.title,c=e.body,u=e.id}let m=`\n    <h2 class="text-center">${a}</h2>\n    <div id="error_message"></div>\n    <form autocomplete="off"  id="note-form"><br>\n      <div hidden id="${u}" name="note_id"></div>\n      <div class="autocomplete">\n        <input size="100" name="title" id="title" type="text" class="" placeholder="Title" value="${d}"><br>\n      </div>\n        <textarea cols="100" name="body" id="body" placeholder="Note..." id="exampleFormControlTextarea1" rows="10">${c}</textarea><br>\n      <div class="autocomplete">\n        <div id="tag_line">\n          <strong>Confirmed tags: </strong><div id="confirmed_tags"></div>\n        </div>\n        <input size="100" name="tags" id="tags" type="text" class="" placeholder="Tags" value="">\n        <button id="create-tag-btn">Create tag</button>\n      </div>\n      <div class="autocomplete">\n      <div id="links_line">\n        <strong>Confirmed links: </strong><div id="confirmed_links"></div>\n      </div>\n        <input size="100" name="links" id="links" type="text" class="" placeholder="Links" value=""><br>\n        <button id="submit-btn">${l}</button>\n      </div>\n    </form>   \n    `;function p(e){let t=document.querySelector("#confirmed_tags"),n=document.createElement("DIV");n.setAttribute("class","confirmed_tag"),n.setAttribute("data-confirmed-tag-name",e.value),n.innerHTML+=`<div class='tag-name' data-tag_id="${e.id}">${e.value}</div>`,n.innerHTML+='<button name="delete-confirmed-tag">X</button>',t.append(n)}function v(e){let t=document.querySelector("#confirmed_links"),n=document.createElement("DIV");n.setAttribute("class","confirmed_links"),n.setAttribute("data-confirmed-link-name",e.value),n.innerHTML+=`<div class='link-name' data-link_id="${e.id}">${e.value}</div>`,n.innerHTML+='<button name="delete-confirmed-link">X</button>',t.append(n)}function h(e){e.preventDefault(),"delete-confirmed-tag"!=e.srcElement.name&&"delete-confirmed-link"!=e.srcElement.name||e.target.parentElement.remove()}function g(){let e=document.getElementById("note-form"),t=e.querySelectorAll('[name="note_id"]')[0].id,n="",i="";return e.querySelectorAll(".confirmed_tag").forEach((e=>{""!=n&&(n+=", ");let t=e.getElementsByClassName("tag-name")[0];n+=t.dataset.tag_id+":"+t.innerText})),e.querySelectorAll(".confirmed_links").forEach((e=>{""!=i&&(i+=", ");let t=e.getElementsByClassName("link-name")[0];i+=t.dataset.link_id+":"+t.innerText})),{id:t,title:e.querySelectorAll("#title")[0].value,body:e.querySelectorAll("#body")[0].value,tags:n,links:i}}i.setAppHtml(m),e.tags&&(0,t.fromDbColumnFormat)(e.tags).forEach((e=>{p(e)})),e.links&&(0,t.fromDbColumnFormat)(e.links).forEach((e=>{v(e)})),"linked_note"==n&&(document.getElementsByName("delete-confirmed-link")[0].setAttribute("disabled",""),history.pushState(null,null,"/create_note")),document.getElementById("create-tag-btn").addEventListener("click",(function(e){e.preventDefault(),function(e){let t="";return""===document.getElementById("tags").value.trim()&&(t+="Tag field can't be blank <br>"),""===t?(document.querySelector("#error_message").innerHTML="Sending...",!0):(document.querySelector("#error_message").innerHTML=t,!1)}()&&o({tag:document.querySelector("#tags").value},"/create_tag",(e=>{console.log("Tag creating status: ",e),location.reload()}))})),document.getElementById("confirmed_tags").addEventListener("click",h),document.getElementById("confirmed_links").addEventListener("click",h),document.getElementById("submit-btn").addEventListener("click",(function(e){console.log("hello"),e.preventDefault(),console.log(g()),function(){let e="";if(""===document.getElementById("title").value&&(e+="Title can't be blank <br>"),""===document.getElementById("body").value&&(e+="Body can't be blank <br>"),""===document.getElementById("confirmed_links").innerHTML&&(e+="Confirmed links field can't be blank <br>"),""===document.getElementById("confirmed_tags").innerHTML&&(e+="Confirmed tags field can't be blank <br>"),""===e)return document.querySelector("#error_message").innerHTML="Sending...",!0;document.querySelector("#error_message").innerHTML=e}()&&o(g(),"/create_note",(e=>{document.querySelector("#error_message").innerHTML="Note has been saved.",console.log("sucsees create: ",e),Router.navigateTo("/show_all")}))})),r("/fetch-all-tags",(e=>{let t=Array();e.forEach((e=>{t.push({id:e.id,value:e.tag})})),new s(document.getElementById("tags"),t,p)})),r("/fetch-all-titles",(e=>{let t=[];e.forEach((e=>{t.push({id:e.id,value:e.title})})),new s(document.getElementById("links"),t,v)}))}}class d extends e{constructor(e){super(e),this.noteId=e.id,this.setTitle("Viewing Note")}async getHtml(){return""}routine(){o({id:this.noteId},"/fetch-note-by-id",(e=>{i.renderNoteView(e[0]),document.getElementsByName("edit-note-btn")[0].addEventListener("click",d.editNote),document.getElementsByName("create-linked-note-btn")[0].addEventListener("click",d.createLinkedNote)}))}static editNote(e){e.preventDefault(),o({id:e.srcElement.id},"/fetch-note-by-id",(e=>{l.renderNoteForm(e[0],"edit_mode"),document.getElementById("submit-btn").addEventListener("click",d.saveNote)}))}static createLinkedNote(e){e.preventDefault(),l.renderNoteForm({links:e.srcElement.id},"linked_note")}static saveNote(e){e.preventDefault(),l.validateForm()&&o(l.collectFormData(),"/edit-note-by-id",(e=>{console.log(e),u.navigateTo(`/view-note/${note_id}`)}))}}const c=[{path:"/",view:class extends e{constructor(e){super(e),this.setTitle("Dashboard")}async getHtml(){return"\n            <h1>Zettelkasten</h1>\n            <p>\n                This is your zettelkasten.\n            </p>\n        "}}},{path:"/show_all",view:a},{path:"/create_note",view:class extends e{constructor(e){super(e),this.setTitle("Settings")}async getHtml(){return""}routine(){l.renderNoteForm({},"create_mode")}}},{path:"/view-note/:id",view:d}];class u{static getParams(e){const t=e.result.slice(1),n=Array.from(e.route.path.matchAll(/:(\w+)/g)).map((e=>e[1]));return Object.fromEntries(n.map(((e,n)=>[e,t[n]])))}static navigateTo(e){history.pushState(null,null,e),u.router()}static async router(){let e=c.map((e=>{return{route:e,result:location.pathname.match((t=e.path,new RegExp("^"+t.replace(/\//g,"\\/").replace(/:\w+/g,"(.+)")+"$")))};var t})).find((e=>null!==e.result));e||(e={route:c[0],result:[location.pathname]});const t=new e.route.view(u.getParams(e));document.querySelector("#app").innerHTML=await t.getHtml(),t.routine()}}window.addEventListener("popstate",u.router),document.addEventListener("DOMContentLoaded",(()=>{document.body.addEventListener("click",(e=>{e.target.matches("[data-link]")&&(e.preventDefault(),u.navigateTo(e.target.href))})),u.router()}))})()})();