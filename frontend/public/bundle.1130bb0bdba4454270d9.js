(()=>{"use strict";const e=class{constructor(e){this.params=e}setTitle(e){document.title=e}async getHtml(){return""}routine(){}};class t{static setAppHtml(e){document.querySelector("#app").innerHTML=e}static renderNoteView(e){let a=new Date(1e3*e.creating_timestamp),n=`\n    Note ${e.id}:  ${e.title}<br>\n    ====================<br>\n    ${e.body}<br>\n    creation date: ${a}<br>\n    tags: ${e.tags}<br>\n    links: ${e.links}<br>\n    <button id='${e.id}' name='edit-note-btn'>Edit</button>\n    `;t.setAppHtml(n)}static renderNoteHead(e){let a='<div id="note_list">';e.reverse().forEach((e=>{a+="<div><br>",a+=e.title+"<br>",a+=`<button id='${e.id}' name='open-note-btn'>Open</button>`,a+=`<button id='${e.id}' name='delete-note-btn'>Delete</button>`,a+="</div>"})),t.setAppHtml(a)}static renderNoteForm(e,a){let n,i,o="",r="",s="",l="",c="";switch(a){case"create_mode":n="Create note",i="Create";break;case"edit_mode":n="Edit note",i="Save",o=e.title,r=e.body,s=e.tags,l=e.links,c=e.id}console.log(e.body);let d=`\n    <h2 class="text-center">${n}</h2>\n    <div id="error_message"></div>\n    <form autocomplete="off"  id="note-form"><br>\n      <div hidden id="${e.id}" name="note_id"></div>\n      <div class="autocomplete">\n        <input size="100" name="title" id="title" type="text" class="" placeholder="Title" value="${e.title}"><br>\n      </div>\n        <textarea cols="100" name="body" id="body" placeholder="Note..." id="exampleFormControlTextarea1" rows="10">${e.body}</textarea><br>\n      <div class="autocomplete">\n        <input size="100" name="tags" id="tags" type="text" class="" placeholder="Tags" value="${e.title}">\n        <button id="create-tag-btn">Create tag</button>\n      </div>\n      <div class="autocomplete">\n        <input size="100" name="links" id="links" type="text" class="" placeholder="Links"value="${e.links}"><br>\n        <button id="submit-btn">${i}</button>\n      </div>\n    </form>   \n    `;t.setAppHtml(d)}}function a(e,t){var a=new XMLHttpRequest;a.onreadystatechange=function(){4==this.readyState&&200==this.status&&t(JSON.parse(a.responseText))},a.open("GET",e,!0),a.send()}function n(e,t,a,n){const i=new XMLHttpRequest;i.onreadystatechange=function(){i.readyState==XMLHttpRequest.DONE&&(200==i.status?a(JSON.parse(i.responseText)):n(JSON.parse(i.statusText)))},i.open("POST",t),i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify(e))}class i extends e{constructor(e){super(e),this.setTitle("ShowAll")}async getHtml(){return a("/fetch-all-notes",this.showAll),""}routine(){}showAll(e){t.renderNoteHead(e),document.querySelector("#note_list").addEventListener("click",i.buttonHandler)}static buttonHandler(e){"open-note-btn"===e.srcElement.name?i.openNote(e.srcElement.id):"delete-note-btn"===e.srcElement.name&&i.deleteNote(e.srcElement.id)}static openNote(e){d.navigateTo(`/view-note/${e}`)}static deleteNote(e){console.log("delete "+e),n({id:e},"/delete-note-by-id",(e=>{console.log(e),location.reload()}))}}class o{constructor(e,t){this.currentFocus=-1,this.inp=e,this.arr=t,this.autocomplete()}autocomplete(){this.inp.addEventListener("input",this.inputListener.bind(this)),this.inp.addEventListener("keydown",this.keyDownListener.bind(this)),document.addEventListener("click",function(e){this.closeAllLists(e.target)}.bind(this))}keyDownListener(e){var t=document.getElementById(this.inp.id+"autocomplete-list");t&&(t=t.getElementsByTagName("div")),40==e.keyCode?(this.currentFocus++,this.addActive(t)):38==e.keyCode?(this.currentFocus--,this.addActive(t)):13==e.keyCode&&(e.preventDefault(),this.currentFocus>-1?t&&t[this.currentFocus].click():t&&1==t.length&&t[0].click())}inputListener(e){let t,a,n=this.inp.value;if(this.closeAllLists(),!n)return!1;this.inp.currentFocus=-1,t=document.createElement("DIV"),t.setAttribute("id",this.inp.id+"autocomplete-list"),t.setAttribute("class","autocomplete-items"),this.inp.parentNode.appendChild(t);for(let e=0;e<this.arr.length;e++)this.arr[e].substr(0,n.length).toUpperCase()==n.toUpperCase()&&(this.arr[e],a=document.createElement("DIV"),a.innerHTML="<strong>"+this.arr[e].substr(0,n.length)+"</strong>",a.innerHTML+=this.arr[e].substr(n.length),a.innerHTML+="<input type='hidden' value='"+this.arr[e]+"'>",a.addEventListener("click",function(e,t){this.inp.value=e,this.closeAllLists()}.bind(this,this.arr[e])),t.appendChild(a))}addActive(e){if(!e)return!1;this.removeActive(e),this.currentFocus>=e.length&&(this.currentFocus=0),this.currentFocus<0&&(this.currentFocus=e.length-1),e[this.currentFocus].classList.add("autocomplete-active")}removeActive(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")}closeAllLists(e){for(var t=document.getElementsByClassName("autocomplete-items"),a=0;a<t.length;a++)e!=t[a]&&e!=this.inp&&t[a].parentNode.removeChild(t[a])}}class r extends e{constructor(e){super(e),this.setTitle("Settings")}async getHtml(){return'\n        <h2 class="text-center">Create note</h2>\n        <div id="error_message"></div>\n        <form autocomplete="off"  id="create-note-form"><br>\n        <div class="autocomplete">\n          <input size="100" name="title" id="title" type="text" class="" placeholder="Title"><br>\n        </div>\n          <textarea cols="100" name="body" id="body" placeholder="Note..." id="exampleFormControlTextarea1" rows="10"></textarea><br>\n        <div class="autocomplete">\n          <input size="100" name="tags" id="tags" type="text" class="" placeholder="Tags">\n          <button id="create-tag-btn">Create tag</button>\n        </div>\n        <div class="autocomplete">\n          <input size="100" name="links" id="links" type="text" class="" placeholder="Links"><br>\n          <button id="submit-btn">Create Note</button>\n        </div>\n        </form>\n      '}routine(){document.getElementById("submit-btn").addEventListener("click",r.submit_form),document.getElementById("create-tag-btn").addEventListener("click",r.createTag),a("/fetch-all-tags",(e=>{let t=Array();e.forEach((e=>{t.push(e.tag)})),new o(document.getElementById("tags"),t)})),a("/fetch-all-titles",(e=>{let t=Array();e.forEach((e=>{t.push(e.title)})),console.log(t),new o(document.getElementById("links"),t)}))}static submit_form(e){e.preventDefault(),r.validateForm()&&function(e,t,a,i=(()=>{})){let o=document.getElementById(e),r=new FormData(o),s={};r.forEach(((e,t)=>s[t]=e)),n(s,t,a,i)}("create-note-form","/create_note",(e=>{document.querySelector("#error_message").innerHTML="Note has been saved.",console.log("sucsees create: "+e)}))}static validateForm(){let e="";if(""===document.getElementById("title").value.trim()&&(e+="Title can't be blank <br>"),""===document.getElementById("body").value.trim()&&(e+="Body can't be blank <br>"),""===document.getElementById("links").value.trim()&&(e+="Links field can't be blank <br>"),""===document.getElementById("tags").value.trim()&&(e+="Tags field can't be blank <br>"),""===e)return document.querySelector("#error_message").innerHTML="Sending...",!0;document.querySelector("#error_message").innerHTML=e}static createTag(e){e.preventDefault(),n({tag:document.querySelector("#tags").value},"/create_tag",(e=>{console.log("Tag creating status: ",e),location.reload()}))}static validateTag(e){let t="";if(""===document.getElementById("title").value.trim()&&(t+="Title can't be blank <br>"),""===t)return document.querySelector("#error_message").innerHTML="Sending...",!0;document.querySelector("#error_message").innerHTML=t}}let s=["Afghanistan","Albania","Algeria","Andorra","Angola","Anguilla","Antigua &amp; Barbuda","Argentina","Armenia","Aruba","Australia","Austria","Azerbaijan","Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bermuda","Bhutan","Bolivia","Bosnia &amp; Herzegovina","Botswana","Brazil","British Virgin Islands","Brunei","Bulgaria","Burkina Faso","Burundi","Cambodia","Cameroon","Canada","Cape Verde","Cayman Islands","Central Arfrican Republic","Chad","Chile","China","Colombia","Congo","Cook Islands","Costa Rica","Cote D Ivoire","Croatia","Cuba","Curacao","Cyprus","Czech Republic","Denmark","Djibouti","Dominica","Dominican Republic","Ecuador","Egypt","El Salvador","Equatorial Guinea","Eritrea","Estonia","Ethiopia","Falkland Islands","Faroe Islands","Fiji","Finland","France","French Polynesia","French West Indies","Gabon","Gambia","Georgia","Germany","Ghana","Gibraltar","Greece","Greenland","Grenada","Guam","Guatemala","Guernsey","Guinea","Guinea Bissau","Guyana","Haiti","Honduras","Hong Kong","Hungary","Iceland","India","Indonesia","Iran","Iraq","Ireland","Isle of Man","Israel","Italy","Jamaica","Japan","Jersey","Jordan","Kazakhstan","Kenya","Kiribati","Kosovo","Kuwait","Kyrgyzstan","Laos","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg","Macau","Macedonia","Madagascar","Malawi","Malaysia","Maldives","Mali","Malta","Marshall Islands","Mauritania","Mauritius","Mexico","Micronesia","Moldova","Monaco","Mongolia","Montenegro","Montserrat","Morocco","Mozambique","Myanmar","Namibia","Nauro","Nepal","Netherlands","Netherlands Antilles","New Caledonia","New Zealand","Nicaragua","Niger","Nigeria","North Korea","Norway","Oman","Pakistan","Palau","Palestine","Panama","Papua New Guinea","Paraguay","Peru","Philippines","Poland","Portugal","Puerto Rico","Qatar","Reunion","Romania","Russia","Rwanda","Saint Pierre &amp; Miquelon","Samoa","San Marino","Sao Tome and Principe","Saudi Arabia","Senegal","Serbia","Seychelles","Sierra Leone","Singapore","Slovakia","Slovenia","Solomon Islands","Somalia","South Africa","South Korea","South Sudan","Spain","Sri Lanka","St Kitts &amp; Nevis","St Lucia","St Vincent","Sudan","Suriname","Swaziland","Sweden","Switzerland","Syria","Taiwan","Tajikistan","Tanzania","Thailand","Timor L'Este","Togo","Tonga","Trinidad &amp; Tobago","Tunisia","Turkey","Turkmenistan","Turks &amp; Caicos","Tuvalu","Uganda","Ukraine","United Arab Emirates","United Kingdom","United States of America","Uruguay","Uzbekistan","Vanuatu","Vatican City","Venezuela","Vietnam","Virgin Islands (US)","Yemen","Zambia","Zimbabwe"];class l extends e{constructor(e){super(e),this.noteId=e.id,this.setTitle("Viewing Note")}async getHtml(){return""}routine(){n({id:this.noteId},"/fetch-note-by-id",(e=>{t.renderNoteView(e[0]),document.getElementsByName("edit-note-btn")[0].addEventListener("click",l.editNote)}))}static editNote(e){e.preventDefault(),n({id:e.srcElement.id},"/fetch-note-by-id",(e=>{t.renderNoteForm(e[0],"edit_mode"),document.getElementById("submit-btn").addEventListener("click",l.saveNote)}))}static saveNote(e){e.preventDefault();let t=document.getElementById("note-form"),a=t.querySelectorAll('[name="note_id"]')[0].id;n({id:a,title:t.querySelectorAll("#title")[0].value,body:t.querySelectorAll("#body")[0].value,tags:t.querySelectorAll("#tags")[0].value,links:t.querySelectorAll("#links")[0].value},"/edit-note-by-id",(e=>{console.log(e),d.navigateTo(`/view-note/${a}`)}))}}const c=[{path:"/",view:class extends e{constructor(e){super(e),this.setTitle("Dashboard")}async getHtml(){return'\n            <h1>Welcome back, Dom</h1>\n            <p>\n                Fugiat voluptate et nisi Lorem cillum anim sit do eiusmod occaecat irure do. Reprehenderit anim fugiat sint exercitation consequat. Sit anim laborum sit amet Lorem adipisicing ullamco duis. Anim in do magna ea pariatur et.\n            </p>\n            <p>\n                <a href="/posts" data-link>View recent posts</a>.\n            </p>\n        '}}},{path:"/show_all",view:i},{path:"/create_note",view:r},{path:"/autocomplete",view:class extends e{constructor(e){super(e),this.postId=e.id,this.setTitle("Autocomplete")}routine(){!function(e,t){var a;function n(e){if(!e)return!1;(function(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")})(e),console.log("before "+e),a>=e.length&&(a=0),a<0&&(a=e.length-1),e[a].classList.add("autocomplete-active")}function i(t){for(var a=document.getElementsByClassName("autocomplete-items"),n=0;n<a.length;n++)t!=a[n]&&t!=e&&a[n].parentNode.removeChild(a[n])}e.addEventListener("input",(function(n){let o,r,s,l=this.value;if(i(),!l)return!1;for(a=-1,o=document.createElement("DIV"),o.setAttribute("id",this.id+"autocomplete-list"),o.setAttribute("class","autocomplete-items"),this.parentNode.appendChild(o),s=0;s<t.length;s++)t[s].substr(0,l.length).toUpperCase()==l.toUpperCase()&&(r=document.createElement("DIV"),r.innerHTML="<strong>"+t[s].substr(0,l.length)+"</strong>",r.innerHTML+=t[s].substr(l.length),r.innerHTML+="<input type='hidden' value='"+t[s]+"'>",r.addEventListener("click",(function(t){console.log(this),e.value=this.getElementsByTagName("input")[0].value,i()})),o.appendChild(r))})),e.addEventListener("keydown",(function(e){var t=document.getElementById(this.id+"autocomplete-list");console.log("before "+t),t&&(t=t.getElementsByTagName("div")),console.log("after "+t),40==e.keyCode?(a++,n(t)):38==e.keyCode?(a--,n(t)):13==e.keyCode&&(e.preventDefault(),a>-1?t&&t[a].click():t&&1==t.length&&t[0].click())})),document.addEventListener("click",(function(e){i(e.target)}))}(document.getElementById("myInput"),s)}async getHtml(){return'\n        <form autocomplete="off">\n          <div class="autocomplete" style="width:300px;">\n            <input id="myInput" type="text" name="myCountry" placeholder="Country">\n          </div>\n          <input type="submit">\n        </form>\n        '}}},{path:"/view-note/:id",view:l}];class d{static getParams(e){const t=e.result.slice(1),a=Array.from(e.route.path.matchAll(/:(\w+)/g)).map((e=>e[1]));return Object.fromEntries(a.map(((e,a)=>[e,t[a]])))}static navigateTo(e){history.pushState(null,null,e),d.router()}static async router(){let e=c.map((e=>{return{route:e,result:location.pathname.match((t=e.path,new RegExp("^"+t.replace(/\//g,"\\/").replace(/:\w+/g,"(.+)")+"$")))};var t})).find((e=>null!==e.result));e||(e={route:c[0],result:[location.pathname]});const t=new e.route.view(d.getParams(e));document.querySelector("#app").innerHTML=await t.getHtml(),t.routine()}}window.addEventListener("popstate",d.router),document.addEventListener("DOMContentLoaded",(()=>{document.body.addEventListener("click",(e=>{e.target.matches("[data-link]")&&(e.preventDefault(),d.navigateTo(e.target.href))})),d.router()}))})();